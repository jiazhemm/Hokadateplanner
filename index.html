<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥ç³»æ‰‹ç¹ªé¢¨ - æ—…éŠè¦åŠƒ App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* æ—¥ç³»æ‰‹ç¹ªé¢¨å°ˆå±¬ CSS è®Šæ•¸ */
        :root {
            --color-primary: #ADD8E6; /* æ·ºè—èƒŒæ™¯ */
            --color-accent: #FFC0CB; /* ç²‰è‰²é‡é» */
            --color-outline: #000000; /* æ¥µè‡´é»‘æ¡†ç·š */
            --shadow-offset: 4px;
        }

        /* ç¡¬é™°å½± (Hard Shadow) æ•ˆæœ */
        .hard-shadow {
            border: 2px solid var(--color-outline);
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0 0 var(--color-outline);
            transition: all 0.1s ease-in-out;
        }

        .hard-shadow:active {
            box-shadow: 1px 1px 0 0 var(--color-outline);
            transform: translate(calc(var(--shadow-offset) - 3px), calc(var(--shadow-offset) - 3px));
        }
        
        /* é é¦–åœ“å¼§åº•éƒ¨çš„é®ç½© */
        .header-curve-mask {
            height: 50px; /* åœ“å¼§é«˜åº¦ */
            position: absolute;
            bottom: -20px; /* è² é‚Šè·å‘ä¸Šæ‹‰å‹• */
            left: 0;
            right: 0;
            background-color: white; /* æ¨¡æ“¬ä¸»å…§å®¹å€çš„ç™½åº• */
            border-radius: 0 0 50% 50% / 0 0 100px 100px;
            z-index: 10;
            border-bottom: 2px solid var(--color-outline);
            border-left: 2px solid var(--color-outline);
            border-right: 2px solid var(--color-outline);
            box-sizing: border-box;
            box-shadow: 0 5px 0 0 var(--color-outline); /* æ¨¡æ“¬åœ“å¼§çš„ç¡¬é™°å½± */
        }
        
        /* èª¿æ•´å­—é«”ç‚ºç²—é«”ç„¡è¥¯ç·š */
        .font-app {
            font-family: 'Arial Black', Gadget, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 font-app">

<div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-lg border-x-2 border-black">
    
    <header class="relative bg-[--color-primary] h-48 hard-shadow-no-hover" style="box-shadow: 0 4px 0 0 var(--color-outline);">
        <div class="p-4 text-white text-3xl font-bold">ğŸ‡¯ğŸ‡µ åŒ—æµ·é“ä¹‹æ—…</div>
        <div class="p-4 pt-0 text-white">2025/12/25 - 2026/01/01</div>

        <div class="absolute bottom-0 left-0 right-0 h-8 bg-white" style="border-radius: 50% / 0 0 100px 100px; margin-bottom: -16px; border-top: 2px solid var(--color-outline);"></div>

        <nav class="absolute bottom-[-10px] right-2 z-20 flex space-x-2">
            <button v-for="tab in tabs" :key="tab.id" 
                    @click="activeTab = tab.id" 
                    :class="{'bg-[--color-accent]': activeTab === tab.id, 'bg-white': activeTab !== tab.id}"
                    class="w-12 h-12 rounded-full hard-shadow flex items-center justify-center text-xl text-black">
                <i :class="tab.icon"></i>
            </button>
        </nav>
    </header>

    <main class="p-4 pt-8 relative">

        <section v-show="activeTab === 'home'" class="grid grid-cols-2 gap-4 pb-20">
            <div class="col-span-2 p-4 bg-white hard-shadow h-40 flex flex-col justify-center items-center cursor-pointer" 
                 style="background-color: #F0F8FF;" @click="activeTab = 'schedule'">
                <i class="fas fa-map-marked-alt text-4xl text-black mb-2"></i>
                <h3 class="text-xl font-bold">æ¯æ—¥è¡Œç¨‹è¡¨</h3>
                <p class="text-sm">æŸ¥çœ‹ & ç·¨è¼¯è¡Œç¨‹è¦åŠƒ</p>
            </div>

            <div class="p-4 bg-white hard-shadow h-24 flex flex-col justify-center items-center cursor-pointer" 
                 style="background-color: #FFF0F5;" @click="activeTab = 'shopping'">
                <i class="fas fa-shopping-basket text-2xl text-black"></i>
                <h3 class="text-md font-bold">è³¼ç‰©æ¸…å–®</h3>
            </div>
            
            <div class="p-4 bg-white hard-shadow h-24 flex flex-col justify-center items-center cursor-pointer" 
                 style="background-color: #FFE4E1;" @click="activeTab = 'expense'">
                <i class="fas fa-yen-sign text-2xl text-black"></i>
                <h3 class="text-md font-bold">èŠ±è²»è¨˜å¸³</h3>
            </div>

            <div class="p-4 bg-white hard-shadow h-24 flex flex-col justify-center items-center cursor-pointer" 
                 style="background-color: #F5FFFA;" @click="activeTab = 'info'">
                <i class="fas fa-info-circle text-2xl text-black"></i>
                <h3 class="text-md font-bold">è³‡è¨Šä¸­å¿ƒ</h3>
            </div>

            <div class="p-4 bg-white hard-shadow h-24 flex flex-col justify-center items-center cursor-pointer" 
                 style="background-color: #F0FFF0;">
                <i class="fas fa-suitcase-rolling text-2xl text-black"></i>
                <h3 class="text-md font-bold">è¡Œææ¸…å–®</h3>
            </div>

            <div class="p-2 bg-white hard-shadow h-40 flex flex-col justify-center items-center cursor-pointer overflow-hidden relative">
                <div class="text-center font-bold absolute top-2 left-2 text-sm z-10">æ—…è¡Œå›æ†¶</div>
                <img :src="images[currentImageIndex]" alt="ç›¸æ¡†ç…§ç‰‡" class="object-cover w-full h-full transform scale-125" style="filter: grayscale(10%);">
            </div>
        </section>

        <section v-show="activeTab === 'schedule'" class="pb-20">
            <h2 class="text-2xl font-bold mb-3">ğŸ—“ æ¯æ—¥è¡Œç¨‹</h2>

            <div class="flex overflow-x-auto space-x-4 pb-3 mb-4 border-b-2 border-black">
                <div v-for="(day, index) in schedule.dates" :key="index"
                     @click="currentDate = day.date"
                     :class="{'bg-[--color-accent] scale-105': currentDate === day.date, 'bg-white': currentDate !== day.date}"
                     class="flex-shrink-0 w-16 h-16 hard-shadow flex flex-col items-center justify-center p-2 cursor-pointer text-sm">
                    <span class="text-lg font-bold">{{ day.weekday }}</span>
                    <span class="text-xs">{{ day.day }}</span>
                </div>
            </div>

            <div v-if="currentWeather" class="flex items-center space-x-3 p-3 mb-4 bg-yellow-50 hard-shadow">
                <i :class="currentWeather.icon" class="text-3xl"></i>
                <div>
                    <span class="text-xl font-bold">{{ currentWeather.temp }}Â°C</span>
                    <span class="text-sm ml-2">é«”æ„Ÿ: {{ currentWeather.feels_like }}Â°C</span>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="(item, index) in filteredSchedule" :key="index" class="relative pl-8">
                    <div v-if="item.transportTime" class="text-xs text-gray-500 mb-1 flex items-center">
                        <i :class="item.transportIcon" class="mr-1"></i> {{ item.transportTime }}
                    </div>

                    <div class="absolute left-3 top-0 bottom-0 w-0.5 bg-black"></div>
                    <div class="absolute left-1 top-1 w-4 h-4 rounded-full bg-[--color-accent] border-2 border-black z-10"></div>

                    <div @click="viewDetails(item)" class="bg-white p-3 hard-shadow cursor-pointer"
                         :class="{'border-l-4 border-[--color-accent]': item.category !== 'èˆªç­', 'border-l-4 border-blue-500': item.category === 'èˆªç­'}">
                        
                        <div v-if="item.category === 'èˆªç­'">
                            <p class="text-lg font-bold text-blue-700"><i class="fas fa-plane"></i> {{ item.name }} ({{ item.flightNo }})</p>
                            <p class="text-sm">èµ·é£›: {{ item.departTime }} ({{ item.departAirport }})</p>
                            <p class="text-sm">æŠµé”: {{ item.arriveTime }} ({{ item.arriveAirport }})</p>
                        </div>
                        
                        <div v-else>
                            <span :class="getCategoryColor(item.category)" class="text-xs font-bold px-2 py-0.5 rounded-full inline-block mb-1 hard-shadow-no-hover">{{ item.category }}</span>
                            <h3 class="text-lg font-bold">{{ item.name }}</h3>
                            <p v-if="item.hours" class="text-sm text-gray-600"><i class="far fa-clock"></i> {{ item.hours }}</p>
                            <p v-if="item.ticket" class="text-sm text-red-500"><i class="fas fa-ticket-alt"></i> é–€ç¥¨: {{ item.ticket }} JPY</p>
                            <p class="text-sm mt-1 text-gray-700">{{ item.notes }}</p>
                            <button @click.stop="openGoogleMap(item.name)" class="mt-2 text-sm text-blue-500 hover:text-blue-700 flex items-center">
                                <i class="fas fa-map-marker-alt mr-1"></i> Google åœ°åœ–å°èˆª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button @click="openModal('schedule', 'add')" class="fixed right-6 bottom-20 w-14 h-14 bg-[--color-accent] rounded-full hard-shadow text-3xl text-black z-30">
                <i class="fas fa-plus"></i>
            </button>
        </section>

        <section v-show="activeTab === 'info'" class="pb-20">
            <h2 class="text-2xl font-bold mb-4">â„¹ï¸ è³‡è¨Šä¸­å¿ƒ</h2>
            
            <div class="p-4 mb-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2 flex items-center"><i class="fas fa-exchange-alt mr-2"></i>å³æ™‚åŒ¯ç‡æ›ç®—</h3>
                <p class="text-sm mb-2 text-gray-600">ç•¶æ—¥åŒ¯ç‡: 1 JPY â‰ˆ {{ exchangeRate }} TWD</p>
                <div class="flex space-x-2">
                    <input type="number" v-model.number="inputJPY" placeholder="è¼¸å…¥æ—¥å¹£ (JPY)"
                           class="flex-1 p-2 border-2 border-black hard-shadow">
                    <button @click="convertCurrency" class="p-2 bg-[--color-accent] hard-shadow">è¨ˆç®—</button>
                </div>
                <p v-if="convertedTWD !== null" class="mt-3 text-lg font-bold">
                    = {{ convertedTWD.toFixed(2) }} TWD
                </p>
            </div>

            <div class="p-4 mb-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2 flex items-center"><i class="fas fa-plane-departure mr-2"></i>èˆªç­è³‡è¨Š</h3>
                <div class="space-y-3">
                    <div v-for="flight in flightInfo" :key="flight.type" class="p-2 border-b border-gray-200 last:border-b-0">
                        <p class="font-bold text-lg" :class="{'text-blue-600': flight.type === 'å»ç¨‹', 'text-green-600': flight.type === 'å›ç¨‹'}">{{ flight.type }}</p>
                        <table class="w-full text-sm">
                            <tr><td class="w-1/3">ç·¨è™Ÿ:</td><td class="font-bold">{{ flight.flightNo }}</td></tr>
                            <tr><td>èµ·é£›:</td><td>{{ flight.departTime }} ({{ flight.departAirport }})</td></tr>
                            <tr><td>æŠµé”:</td><td>{{ flight.arriveTime }} ({{ flight.arriveAirport }})</td></tr>
                            <tr><td>é£›è¡Œæ™‚é–“:</td><td>{{ flight.duration }}</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="p-4 mb-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2 flex items-center"><i class="fas fa-hotel mr-2"></i>ä½å®¿è³‡è¨Š</h3>
                <p>é£¯åº—: {{ accommodation.name }}</p>
                <p>é›»è©±: {{ accommodation.phone }}</p>
                <p class="flex items-center">åœ°å€: {{ accommodation.address }} 
                    <button @click="openGoogleMap(accommodation.address)" class="ml-2 text-blue-500"><i class="fas fa-external-link-alt"></i></button>
                </p>
            </div>
            
            <div class="p-4 mb-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2"><i class="fas fa-car mr-2"></i>ç§Ÿè»Šè³‡è¨Š</h3>
                <p class="text-sm">... ç§Ÿè»Šå…¬å¸åç¨±, é›»è©±, é ç´„è™Ÿç¢¼ ...</p>
            </div>
            
            <div class="p-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2 text-red-600"><i class="fas fa-heartbeat mr-2"></i>ç·Šæ€¥é†«ç™‚</h3>
                <p>è­¦å¯Ÿ: 110 (æ—¥æœ¬ 110)</p>
                <p>æ•‘è­·è»Š/ç«è­¦: 119 (æ—¥æœ¬ 119)</p>
            </div>

        </section>

        <section v-show="activeTab === 'shopping'" class="pb-20">
            <h2 class="text-2xl font-bold mb-4">ğŸ›ï¸ è³¼ç‰©/ä¼´æ‰‹ç¦®æ¸…å–®</h2>
            
            <div v-for="(item, index) in shoppingList" :key="index" class="p-3 mb-3 bg-white hard-shadow flex items-center">
                <input type="checkbox" v-model="item.checked" class="w-5 h-5 mr-3 border-2 border-black accent-[--color-accent]">
                <div class="flex-1">
                    <p class="font-bold text-lg" :class="{'line-through text-gray-500': item.checked}">{{ item.name }}</p>
                </div>
                <div v-if="item.image" class="w-12 h-12 bg-gray-200 border border-black overflow-hidden ml-2 flex-shrink-0">
                    <img :src="item.image" alt="å•†å“åœ–" class="w-full h-full object-cover">
                </div>
            </div>
            
            <button @click="openModal('shopping', 'add')" class="fixed right-6 bottom-20 w-14 h-14 bg-[--color-accent] rounded-full hard-shadow text-3xl text-black z-30">
                <i class="fas fa-plus"></i>
            </button>
        </section>

        <section v-show="activeTab === 'expense'" class="pb-20">
            <h2 class="text-2xl font-bold mb-4">ğŸ’¸ æ—…éŠèŠ±è²»ç´€éŒ„</h2>
            
            <div class="p-4 mb-4 bg-white hard-shadow text-center">
                <p class="text-lg text-gray-600">ç¸½èŠ±è²» (TWD)</p>
                <p class="text-3xl font-bold text-red-600">NT$ {{ totalExpenseTWD.toFixed(0) }}</p>
                <p class="text-sm text-gray-500">({{ totalExpenseJPY.toFixed(0) }} JPY)</p>
            </div>
            
            <div class="p-4 mb-4 bg-white hard-shadow">
                <h3 class="text-xl font-bold mb-2">å¿«é€Ÿè¨˜å¸³/åŒ¯ç‡è¨ˆç®—æ©Ÿ</h3>
                <div class="text-right text-3xl font-bold mb-2 border-b-2 border-black h-10">{{ calculatorInput || '0' }} JPY</div>
                <div class="text-right text-xl text-gray-600">= {{ (calculatorInput * exchangeRate).toFixed(0) }} TWD</div>
                
                <div class="grid grid-cols-4 gap-2 mt-4">
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(7)">7</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(8)">8</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(9)">9</button>
                    <button class="col-span-1 p-3 bg-red-200 hard-shadow" @click="clearCalculator">C</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(4)">4</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(5)">5</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(6)">6</button>
                    <button class="col-span-1 p-3 bg-blue-200 hard-shadow" @click="openModal('expense', 'add', calculatorInput)">è¨˜å¸³</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(1)">1</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(2)">2</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(3)">3</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator(0)">0</button>
                    <button class="col-span-1 p-3 bg-gray-200 hard-shadow" @click="appendCalculator('.')">.</button>
                </div>
            </div>
            
            <div v-for="(item, index) in expenseList" :key="index" class="p-3 mb-3 bg-white hard-shadow flex justify-between items-center">
                <div>
                    <span :class="getCategoryColor(item.category)" class="text-xs font-bold px-2 py-0.5 rounded-full inline-block mb-1 hard-shadow-no-hover">{{ item.category }}</span>
                    <p class="font-bold text-lg">{{ item.name }}</p>
                    <p class="text-sm text-gray-500">{{ item.date }} / {{ item.payment }}</p>
                </div>
                <div class="text-right">
                    <p class="text-xl font-bold text-red-600">{{ item.amountJPY }} JPY</p>
                    <p class="text-sm text-gray-500">~ {{ (item.amountJPY * exchangeRate).toFixed(0) }} TWD</p>
                </div>
            </div>

            <button @click="openModal('expense', 'add')" class="fixed right-6 bottom-20 w-14 h-14 bg-[--color-accent] rounded-full hard-shadow text-3xl text-black z-30">
                <i class="fas fa-plus"></i>
            </button>
        </section>


        <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto p-4 bg-white border-t-2 border-black shadow-2xl">
            <button @click="handleGlobalAdd" class="w-full p-3 bg-[--color-accent] text-black font-bold text-lg hard-shadow">
                + æ–°å¢ {{ currentTabName }}
            </button>
        </div>

        <button v-show="activeTab !== 'expense'" @click="showFloatingCalculator = !showFloatingCalculator"
                class="fixed left-6 bottom-20 w-14 h-14 bg-gray-400 rounded-full hard-shadow text-xl text-white z-30">
            <i class="fas fa-calculator"></i>
        </button>
        
        <div v-if="showFloatingCalculator" class="fixed left-6 bottom-40 w-48 p-3 bg-white hard-shadow z-40">
            <h4 class="font-bold mb-1">å³æ™‚åŒ¯ç‡</h4>
            <div class="text-right text-xl font-bold mb-1 border-b border-black">{{ calculatorInput || '0' }} JPY</div>
            <div class="text-right text-md text-gray-600">= {{ (calculatorInput * exchangeRate).toFixed(0) }} TWD</div>
            <div class="grid grid-cols-4 gap-1 mt-2">
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(7)">7</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(8)">8</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(9)">9</button>
                <button class="p-1 bg-red-200 hard-shadow-small" @click="clearCalculator">C</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(4)">4</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(5)">5</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(6)">6</button>
                <button class="p-1 bg-gray-200 hard-shadow-small" @click="appendCalculator(0)">0</button>
            </div>
            <p class="text-xs mt-2 text-center text-gray-500" @click="showFloatingCalculator = false">é»æ“Šéš±è—</p>
        </div>


        <div v-if="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm p-5 hard-shadow">
                <h3 class="text-2xl font-bold mb-4">{{ modalTitle }}</h3>
                
                <div v-if="modalType === 'schedule'">
                    <label class="block mb-2 font-bold">åç¨±</label>
                    <input type="text" v-model="tempItem.name" class="w-full p-2 mb-3 border-2 border-black hard-shadow">
                    
                    <label class="block mb-2 font-bold">åˆ†é¡</label>
                    <select v-model="tempItem.category" class="w-full p-2 mb-3 border-2 border-black hard-shadow">
                        <option>æ™¯é»</option><option>ä½å®¿</option><option>ç¾é£Ÿ</option>
                        <option>è³¼ç‰©</option><option>èˆªç­</option><option>å…¶ä»–</option>
                    </select>

                    <label class="block mb-2 font-bold">ç‰¹è‰² & å‚™è¨»</label>
                    <textarea v-model="tempItem.notes" class="w-full p-2 mb-4 border-2 border-black hard-shadow"></textarea>

                    <button v-if="modalMode === 'edit'" @click="showDeleteConfirm = true" class="w-full p-3 bg-red-500 text-white font-bold hard-shadow mb-3">
                        åˆªé™¤è¡Œç¨‹
                    </button>
                </div>

                <div v-if="showDeleteConfirm" class="absolute inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center p-4">
                    <p class="text-xl font-bold mb-4">ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ</p>
                    <div class="flex space-x-4">
                        <button @click="deleteItem" class="p-2 bg-red-500 text-white hard-shadow">ç¢ºå®šåˆªé™¤</button>
                        <button @click="showDeleteConfirm = false" class="p-2 bg-gray-300 hard-shadow">å–æ¶ˆ</button>
                    </div>
                </div>

                <div class="flex space-x-3">
                    <button @click="closeModal" class="flex-1 p-3 bg-gray-300 hard-shadow">å–æ¶ˆ</button>
                    <button @click="saveItem" class="flex-1 p-3 bg-[--color-accent] text-black font-bold hard-shadow">
                        {{ modalMode === 'add' ? 'æ–°å¢' : 'å„²å­˜' }}
                    </button>
                </div>
            </div>
        </div>

    </main>

</div>

<script>
    // Vue.js App é‚è¼¯
    const { createApp, ref, computed, onMounted } = Vue;

    const App = {
        setup() {
            // --- æ ¸å¿ƒç‹€æ…‹ ---
            const activeTab = ref('home'); // ç•¶å‰åˆ†é : home, schedule, info, shopping, expense
            const tabs = [
                { id: 'home', icon: 'fas fa-th-large', name: 'é¦–é ' },
                { id: 'schedule', icon: 'fas fa-map-marked-alt', name: 'æ¯æ—¥è¡Œç¨‹è¡¨' },
                { id: 'info', icon: 'fas fa-info-circle', name: 'è³‡è¨Š' },
                { id: 'shopping', icon: 'fas fa-shopping-basket', name: 'è³¼ç‰©æ¸…å–®' },
                { id: 'expense', icon: 'fas fa-yen-sign', name: 'èŠ±è²»' },
            ];

            const currentDate = ref('2025-12-25');
            const showFloatingCalculator = ref(false);
            const calculatorInput = ref(''); // è¨ˆç®—æ©Ÿè¼¸å…¥

            // --- æ¨¡æ“¬è³‡æ–™ (å¯¦éš›æ‡‰å¾ Firebase è¼‰å…¥) ---
            const exchangeRate = ref(0.2155); // æ¨¡æ“¬æ—¥å¹£å…Œå°å¹£åŒ¯ç‡ (1 JPY = 0.2155 TWD)
            
            const schedule = ref({
                dates: [
                    { date: '2025-12-25', weekday: 'å››', day: '25' },
                    { date: '2025-12-26', weekday: 'äº”', day: '26' },
                    { date: '2025-12-27', weekday: 'å…­', day: '27' },
                    { date: '2025-12-28', weekday: 'æ—¥', day: '28' },
                    { date: '2025-12-29', weekday: 'ä¸€', day: '29' },
                    { date: '2025-12-30', weekday: 'äºŒ', day: '30' },
                    { date: '2025-12-31', weekday: 'ä¸‰', day: '31' },
                ],
                items: [
                    { date: '2025-12-25', id: 1, name: 'è™èˆª IT0236', category: 'èˆªç­', flightNo: 'IT0236', departTime: '06:45', arriveTime: '11:10', departAirport: 'æ¡ƒåœ’ TPE', arriveAirport: 'å‡½é¤¨ HKD', isDeparture: true, transportTime: null },
                    { date: '2025-12-25', id: 2, name: 'å‡½é¤¨æœå¸‚', category: 'ç¾é£Ÿ', hours: '06:00-14:00', notes: 'æµ·é®®ä¸¼é£¯ï¼', transportTime: '30 åˆ†é˜ (å…¬è»Š)', transportIcon: 'fas fa-bus' },
                    { date: '2025-12-25', id: 3, name: 'å‡½é¤¨å±±å¤œæ™¯', category: 'æ™¯é»', ticket: '1500', notes: 'ä¸–ç•Œä¸‰å¤§å¤œæ™¯ä¹‹ä¸€', transportTime: '20 åˆ†é˜ (é–‹è»Š)', transportIcon: 'fas fa-car' },
                    { date: '2025-12-25', id: 4, name: 'La Vista å‡½é¤¨ç£', category: 'ä½å®¿', hours: 'Check-in 15:00', notes: 'é ‚æ¨“æº«æ³‰', transportTime: '15 åˆ†é˜ (æ­¥è¡Œ)', transportIcon: 'fas fa-walking' },
                    // ç¬¬äºŒå¤©æ¨¡æ“¬è³‡æ–™
                    { date: '2025-12-26', id: 5, name: 'äº”ç¨œéƒ­å…¬åœ’', category: 'æ™¯é»', hours: '08:00-18:00', ticket: '900', notes: 'æ˜Ÿå½¢è¦å¡', transportTime: '20 åˆ†é˜ (é–‹è»Š)', transportIcon: 'fas fa-car' },
                ]
            });

            const flightInfo = [
                { type: 'å»ç¨‹', flightNo: 'IT0236', departAirport: 'æ¡ƒåœ’ TPE', departTime: '06:45', arriveAirport: 'å‡½é¤¨ HKD', arriveTime: '11:10', duration: '3h 25m' },
                { type: 'å›ç¨‹', flightNo: 'IT0237', departAirport: 'å‡½é¤¨ HKD', departTime: '12:20', arriveAirport: 'æ¡ƒåœ’ TPE', arriveTime: '16:00', duration: '3h 40m' },
            ];

            const accommodation = {
                name: 'La Vista å‡½é¤¨ç£', phone: '+81 138-23-6111', address: 'åŒ—æµ·é“å‡½é¤¨å¸‚è±å·ç”º11-12'
            };

            const shoppingList = ref([
                { name: 'ç™½è‰²æˆ€äºº', image: 'https://via.placeholder.com/150/FFC0CB?text=W', checked: false },
                { name: 'è–¯æ¢ä¸‰å…„å¼Ÿ', image: 'https://via.placeholder.com/150/ADD8E6?text=P', checked: true },
                { name: 'å…­èŠ±äº­ è‰è“å·§å…‹åŠ›', image: 'https://via.placeholder.com/150/F0F8FF?text=R', checked: false },
            ]);

            const expenseList = ref([
                { date: '2025-12-25', category: 'é£²é£Ÿ', name: 'å‡½é¤¨æœå¸‚æ—©é¤', amountJPY: 3500, payment: 'ç¾é‡‘' },
                { date: '2025-12-25', category: 'é–€ç¥¨', name: 'å‡½é¤¨å±±çºœè»Š', amountJPY: 1500, payment: 'ä¿¡ç”¨å¡' },
                { date: '2025-12-26', category: 'äº¤é€š', name: 'JR ä¸€æ—¥åˆ¸', amountJPY: 5000, payment: 'ç¾é‡‘' },
            ]);
            
            // --- Computed å±¬æ€§ ---
            const currentTabName = computed(() => {
                const tab = tabs.find(t => t.id === activeTab.value);
                return tab ? tab.name : 'é …ç›®';
            });
            
            // è¡Œç¨‹è¡¨éæ¿¾ç•¶å‰æ—¥æœŸ
            const filteredSchedule = computed(() => {
                return schedule.value.items.filter(item => item.date === currentDate.value);
            });
            
            // ç¸½èŠ±è²»è¨ˆç®— (JPY & TWD)
            const totalExpenseJPY = computed(() => {
                return expenseList.value.reduce((sum, item) => sum + item.amountJPY, 0);
            });
            const totalExpenseTWD = computed(() => {
                return totalExpenseJPY.value * exchangeRate.value;
            });
            
            // æ¨¡æ“¬å¤©æ°£è³‡è¨Š (æ‡‰é€é API ç²å–)
            const currentWeather = computed(() => {
                // æ ¹æ“šæ—¥æœŸæ¨¡æ“¬ä¸åŒå¤©æ°£
                if (currentDate.value === '2025-12-26') {
                    return { icon: 'fas fa-snowflake text-blue-500', temp: 0, feels_like: -5 };
                }
                return { icon: 'fas fa-sun text-yellow-500', temp: 5, feels_like: 2 };
            });

            // é›œèªŒå°é¢ç…§ç‰‡è¼ªæ’­
            const images = ['https://via.placeholder.com/150/ADD8E6?text=1', 'https://via.placeholder.com/150/FFC0CB?text=2', 'https://via.placeholder.com/150/000000?text=3'];
            const currentImageIndex = ref(0);

            // --- Modal ç‹€æ…‹èˆ‡æ“ä½œ ---
            const isModalOpen = ref(false);
            const modalType = ref(''); // schedule, shopping, expense
            const modalMode = ref('add'); // add, edit
            const modalTitle = computed(() => {
                if (modalMode.value === 'add') return `æ–°å¢${currentTabName.value.replace('æ¸…å–®', '').replace('ç´€éŒ„', '')}`;
                return `ç·¨è¼¯${currentTabName.value.replace('æ¸…å–®', '').replace('ç´€éŒ„', '')}`;
            });
            const tempItem = ref({}); // æš«å­˜ç·¨è¼¯æˆ–æ–°å¢çš„é …ç›®
            const showDeleteConfirm = ref(false);
            
            // --- æ–¹æ³• Methods ---
            
            // è™•ç†åº•éƒ¨é•·æ¢æŒ‰éˆ•é»æ“Š
            const handleGlobalAdd = () => {
                openModal(activeTab.value, 'add');
            };

            // é–‹å•Ÿ Google Map å°èˆª
            const openGoogleMap = (destination) => {
                const url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(destination)}`;
                window.open(url, '_blank');
            };

            // åŒ¯ç‡è¨ˆç®—æ©Ÿ
            const inputJPY = ref(10000);
            const convertedTWD = ref(null);
            const convertCurrency = () => {
                convertedTWD.value = inputJPY.value * exchangeRate.value;
            };

            // è¨ˆç®—æ©Ÿé‚è¼¯
            const appendCalculator = (value) => {
                if (value === '.') {
                    if (!calculatorInput.value.includes('.')) {
                        calculatorInput.value += value;
                    }
                } else {
                    calculatorInput.value += value.toString();
                }
            };
            const clearCalculator = () => {
                calculatorInput.value = '';
            };

            // å–å¾—åˆ†é¡é¡è‰² (è¦–è¦ºåŒ–ç”¨)
            const getCategoryColor = (category) => {
                switch(category) {
                    case 'æ™¯é»': return 'bg-green-200 text-green-800';
                    case 'ä½å®¿': return 'bg-yellow-200 text-yellow-800';
                    case 'ç¾é£Ÿ': return 'bg-red-200 text-red-800';
                    case 'è³¼ç‰©': return 'bg-blue-200 text-blue-800';
                    case 'èˆªç­': return 'bg-indigo-200 text-indigo-800';
                    default: return 'bg-gray-200 text-gray-800';
                }
            };

            // é–‹å•Ÿ Modal
            const openModal = (type, mode, initialValue = null) => {
                modalType.value = type;
                modalMode.value = mode;
                isModalOpen.value = true;
                showDeleteConfirm.value = false;
                tempItem.value = {}; // é‡ç½®
                
                if (type === 'expense' && initialValue !== null) {
                    tempItem.value.amountJPY = parseFloat(initialValue);
                }
            };

            // å„²å­˜é …ç›® (ç°¡åŒ–é‚è¼¯)
            const saveItem = () => {
                // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡æœƒæ˜¯å‘¼å« Firebase API é€²è¡Œè³‡æ–™å„²å­˜
                console.log(`å„²å­˜ ${modalType.value} é …ç›®:`, tempItem.value);

                // æ¨¡æ“¬æ–°å¢åˆ°åˆ—è¡¨ä¸­
                if (modalMode.value === 'add') {
                    if (modalType.value === 'schedule') {
                        tempItem.value.date = currentDate.value;
                        tempItem.value.id = Date.now();
                        schedule.value.items.push({...tempItem.value, transportTime: 'é‡æ–°è¨ˆç®—ä¸­...'}); // æ¨¡æ“¬éœ€è¦é‡æ–°è¨ˆç®—äº¤é€š
                    } else if (modalType.value === 'expense') {
                        expenseList.value.push({
                            date: new Date().toISOString().split('T')[0],
                            category: 'å…¶ä»–', name: 'æœªå‘½å', amountJPY: tempItem.value.amountJPY || 0, payment: 'ç¾é‡‘',
                            ...tempItem.value
                        });
                    }
                    // TODO: é€™è£¡éœ€è¦é‡æ–°è¨ˆç®—è¡Œç¨‹çš„äº¤é€šæ™‚é–“
                }
                
                closeModal();
            };

            // åˆªé™¤é …ç›® (ç°¡åŒ–é‚è¼¯)
            const deleteItem = () => {
                // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡æœƒæ˜¯å‘¼å« Firebase API åˆªé™¤
                if (modalType.value === 'schedule') {
                    const index = schedule.value.items.findIndex(i => i.id === tempItem.value.id);
                    if (index !== -1) {
                        schedule.value.items.splice(index, 1);
                    }
                }
                closeModal();
            };

            // æª¢è¦–/ç·¨è¼¯ç´°ç¯€ (é–‹å•Ÿç·¨è¼¯ Modal)
            const viewDetails = (item) => {
                if (item.category === 'èˆªç­' && item.isDeparture) return; // èˆªç­è³‡è¨Šä¸ç›´æ¥ç·¨è¼¯
                modalType.value = 'schedule';
                modalMode.value = 'edit';
                tempItem.value = {...item}; // è¤‡è£½ç‰©ä»¶ä»¥é¿å…ç›´æ¥ä¿®æ”¹
                isModalOpen.value = true;
            };

            const closeModal = () => {
                isModalOpen.value = false;
                tempItem.value = {};
                showDeleteConfirm.value = false;
                calculatorInput.value = ''; // é—œé–‰ Modal é‡ç½®è¨ˆç®—æ©Ÿ
            };
            
            // åœ–ç‰‡è¼ªæ’­
            const startImageCarousel = () => {
                setInterval(() => {
                    currentImageIndex.value = (currentImageIndex.value + 1) % images.length;
                }, 4000); // æ¯ 4 ç§’æ›ä¸€å¼µ
            };


            onMounted(() => {
                // å•Ÿå‹•åœ–ç‰‡è¼ªæ’­
                startImageCarousel();
                // åˆå§‹åŒ–åŒ¯ç‡è¨ˆç®—
                convertCurrency();
                // TODO: å¯¦éš›å°ˆæ¡ˆä¸­ï¼Œé€™è£¡æ‡‰åˆå§‹åŒ– Firebase é€£ç·šä¸¦è¼‰å…¥è³‡æ–™
                console.log("App åˆå§‹åŒ–å®Œæˆï¼Œè«‹é…ç½®æ‚¨çš„ Firebase å’Œ Google Maps API Keysã€‚");
            });

            return {
                activeTab, tabs, currentDate,
                currentTabName, filteredSchedule,
                flightInfo, accommodation, shoppingList, expenseList, totalExpenseJPY, totalExpenseTWD,
                isModalOpen, modalType, modalMode, modalTitle, tempItem, showDeleteConfirm,
                openModal, closeModal, saveItem, deleteItem, viewDetails, handleGlobalAdd,
                openGoogleMap,
                // åŒ¯ç‡/è¨ˆç®—æ©Ÿ
                exchangeRate, inputJPY, convertedTWD, convertCurrency,
                showFloatingCalculator, calculatorInput, appendCalculator, clearCalculator,
                getCategoryColor,
                // é¦–é 
                images, currentImageIndex,
                currentWeather,
            };
        }
    };

    createApp(App).mount('#app');
</script>
</body>
</html>
